<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tic-Tac-Toe</title>
    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
    <script>
        const socket = io.connect(location.protocol + '//' + document.domain + ':' + location.port);
        let currentRoom = '';
        let currentPlayer = '';

        socket.on('game_status', function(data) {
            if (data.status === 'joined') {
                if (data.players.length === 1) {
                    alert('Waiting for another player...');
                } else {
                    currentPlayer = data.turn;
                    alert('Players Found, please click on Join Game ! Players: ' + data.players.join(', '));
                    updateBoard(data.board);
                }
            } else if (data.status === 'full') {
                alert('This room is full!');
            } else if (data.status === 'rejoined') {
                currentPlayer = data.turn;
                updateBoard(data.board);
            }
        });

        socket.on('move_made', function(data) {
            currentPlayer = data.turn;
            updateBoard(data.board);
        });

        socket.on('game_over', function(data) {
            
    if (data.winner === 'Draw') {
        alert('Game over, it\'s a draw!');
    } else {
        alert('Game over, ' + data.winner + ' wins!');
    }
});
        
function createRoom() {
    const username = document.getElementById('username').value;
    const room = document.getElementById('room').value;  // Get the custom room name
    if (!username || !room) {
        alert('Username and room name are required!');
        return;
    }
    socket.emit('join', {'username': username, 'action': 'create', 'room': room});
}

socket.on('room_created', function(data) {
    console.log(`New room created: ${data.room}`);
    addRoomToList(data.room);
});
function addRoomToList(room) {
    const activeRoomsElement = document.getElementById('active-rooms');
    const roomElement = document.createElement('div');
    roomElement.innerText = room;
    roomElement.onclick = function() { joinRoom(room); };
    activeRoomsElement.appendChild(roomElement);
}
function joinGame() {
    const username = document.getElementById('username').value;
    const room = document.getElementById('room').value;
    if (!username || !room) {
        alert('Username and room are required!');
        return;
    }
    currentRoom = room;
    socket.emit('join', {'username': username, 'room': room});
}

        function makeMove(position) {
            if (currentPlayer === '') {
                alert('Please wait for your turn.');
                return;
            }
            socket.emit('move', {'position': position, 'player': currentPlayer, 'room': currentRoom});
        }

        function updateBoard(board) {
            const boardElement = document.getElementById('board');
            boardElement.innerHTML = '';
            board.forEach((cell, index) => {
                const cellElement = document.createElement('div');
                cellElement.className = 'cell';
                cellElement.innerText = cell;
                cellElement.onclick = () => makeMove(index);
                boardElement.appendChild(cellElement);
            });
        }
        document.addEventListener('DOMContentLoaded', (event) => {
            requestActiveRooms();
        });
        socket.on('active_rooms', function(data) {
            const activeRoomsElement = document.getElementById('active-rooms');
            activeRoomsElement.innerHTML = '';  
            data.rooms.forEach(room => addRoomToList(room));
        });
        
        function joinRoom(room) {
            console.log('Joining room:', room); // For debugging purposes
            document.getElementById('room').value = room;
            joinGame();
        }
        
        function requestActiveRooms() {
            socket.emit('get_active_rooms');
        }
        
    
        requestActiveRooms();
    </script>
    <style>
        


        .container {
            max-width: 600px;
            margin: 20px auto;
            padding: 20px;
            font-family: 'Arial', sans-serif;
            background-color: #f9f9f9;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
        }
        
        h1 {
            color: #333;
            text-align: center;
        }
        
        .user-inputs {
            margin-bottom: 20px;
            text-align: center;
        }
        
        input[type="text"] {
            padding: 10px;
            margin-right: 10px;
            border: 2px solid #007bff;
            border-radius: 5px;
            font-size: 16px;
            color: #333;
        }
        
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            background-color: #007bff;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.1s;
        }
        
        button:hover {
            background-color: #0056b3;
            transform: scale(1.05);
        }
        
        #active-rooms-section {
            margin-top: 20px;
            background-color: #e3f2fd;
            border: 1px solid #90caf9;
            border-radius: 5px;
            padding: 10px;
        }
        
        #active-rooms-section h2 {
            text-align: center;
            color: #0277bd;
        }
        
        .rooms-list div {
            padding: 10px;
            background-color: #ffffff;
            margin: 5px 0;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s;
            border-left: 5px solid #0277bd;
        }
        
        .rooms-list div:hover {
            background-color: #f0f0f0;
        }
        
        #board {
            margin-top: 20px;
            display: grid;
            grid-template-columns: repeat(3, 100px);
            grid-template-rows: repeat(3, 100px);
            gap: 5px;
            justify-content: center;
        }
        
        .cell {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100px;
            background-color: #fff;
            border: 2px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
            font-size: 24px;
            color: #333;
        }
        
        .cell:hover {
            background-color: #f0f0f0;
            transform: scale(1.1);
        }
        
            
        
    </style>
</head>
<body>
    Username: <input type="text" id="username" />
    Room: <input type="text" id="room" />
<button onclick="createRoom()">Create Room</button>
<button onclick="joinGame()">Join Game</button>
<div class="rooms-section">
    <h2>Rooms Available</h2>
    <div id="active-rooms" class="rooms-list"></div>
</div>

<div id="board"></div>
</body>
</html>
