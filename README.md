## Lab 12: S3, DB, Lambda

**Name:** Nouran Elmenshawy  
**Group:** 9:15 am Tuesday
**Date:** 24/06/2024

### Objective
The objective of this task was to add the ability to upload profile pictures and store game results in the database within our Tic-Tac-Toe application.

### Architecture

The architecture includes:

- **AWS S3:** Used to store user profile pictures.
- **AWS DynamoDB:** Used to store game results.
- **AWS Lambda:** Processes game results and updates the ranking in DynamoDB.
- **Amazon API Gateway:** Provides REST API endpoints for submitting game results.
- **AWS SNS:** Sends notifications about ranking updates.

### Implementation Details

1. **Terraform Configuration:**
   - Configured an S3 bucket (`tic-tac-toe-pic-bucket-unique-name-12345`) to store profile pictures.
   - Configured a DynamoDB table (`TicTacToeScoresNew`) for storing game results with `GameId` and `Timestamp` as keys.
   - Created an SNS topic (`RankingNotifications`) for sending notifications.
   - Configured security groups to ensure only the backend application can access the DynamoDB table.

2. **Profile Picture Upload:**
   - Implemented an API endpoint (`/api/upload_profile_picture`) to handle profile picture uploads.
   - Generated pre-signed URLs for secure uploading of images to S3.
   - Displayed uploaded profile pictures next to each player's name during the game.

3. **Storing Game Results:**
   - Added an endpoint (`/api/submit_game_result`) to save game results in DynamoDB.
   - Used a Lambda function (`UpdateRanking`) to process game results and update rankings.
   - Configured API Gateway to invoke the Lambda function when game results are submitted.

4. **Database Security:**
   - Restricted access to the DynamoDB table using IAM roles and security groups.
   - Configured the network to ensure that only the backend application can communicate with the database.

5. **Rationale for Database Choice:**
   - **DynamoDB** was chosen because it is a managed NoSQL database service that offers fast and predictable performance with seamless scalability. It is ideal for storing game results due to its flexibility, low latency, and the ability to handle high volumes of concurrent requests.

6. **Lambda Function for Updating Rankings:**
   - Created a Lambda function to process game results and update rankings in DynamoDB.
   - Configured an API Gateway to serve as the endpoint for submitting game results.
   - Ensured the Lambda function sends notifications to the SNS topic subscribers after updating the rankings.

7. **SNS Notifications:**
   - Configured SNS to notify users about their updated positions in the ranking.
   - The Lambda function publishes a message to the SNS topic after updating the ranking.

### Challenges and Solutions

1. **Challenge:** Handling the upload of profile pictures securely.
   - **Solution:** Used pre-signed URLs generated by S3 to securely upload profile pictures.

2. **Challenge:** Ensuring secure communication between the backend and DynamoDB.
   - **Solution:** Configured IAM roles and security groups to restrict access to the DynamoDB table.

3. **Challenge:** Processing and storing game results efficiently.
   - **Solution:** Used a Lambda function triggered by API Gateway to process game results and store them in DynamoDB.

4. **Challenge:** Sending notifications to users about ranking updates.
   - **Solution:** Integrated AWS SNS with the Lambda function to send notifications after ranking updates.
  
     
<img width="1241" alt="Screenshot 2024-06-24 at 12 45 31" src="https://github.com/pwr-cloudprogramming/a12-NouranElmenshawy/assets/147437528/a8f31a8e-6c01-44ea-b59d-41fc669a2b2c">
<img width="1410" alt="Screenshot 2024-06-24 at 20 11 26" src="https://github.com/pwr-cloudprogramming/a12-NouranElmenshawy/assets/147437528/de64e7bf-0e38-4dbc-8ac0-a545b8e20e45">
<img width="1411" alt="Screenshot 2024-06-24 at 20 58 12" src="https://github.com/pwr-cloudprogramming/a12-NouranElmenshawy/assets/147437528/7230bce1-cf93-4722-9f78-2bc8e5dba657">

<img width="1422" alt="Screenshot 2024-06-24 at 20 58 21" src="https://github.com/pwr-cloudprogramming/a12-NouranElmenshawy/assets/147437528/83c3e7ba-2f17-4cb1-8627-a1ac6082ade8">
<img width="1402" alt="Screenshot 2024-06-24 at 20 58 27" src="https://github.com/pwr-cloudprogramming/a12-NouranElmenshawy/assets/147437528/79f5c66f-4895-4228-8667-96518ac4eb4b">

<img width="1437" alt="Screenshot 2024-06-24 at 20 58 41" src="https://github.com/pwr-cloudprogramming/a12-NouranElmenshawy/assets/147437528/6c4b332c-f31b-4e87-9552-da925482bfe2">
<img width="1403" alt="Screenshot 2024-06-24 at 20 58 46" src="https://github.com/pwr-cloudprogramming/a12-NouranElmenshawy/assets/147437528/5ceb6033-71b6-47b5-a553-91e8e4fbe8ff">
<img width="1389" alt="Screenshot 2024-06-24 at 20 59 09" src="https://github.com/pwr-cloudprogramming/a12-NouranElmenshawy/assets/147437528/a5aa826b-c475-481c-b749-23caaeaba874">
<img width="1391" alt="Screenshot 2024-06-24 at 20 59 13" src="https://github.com/pwr-cloudprogramming/a12-NouranElmenshawy/assets/147437528/c6ab467d-f9d1-4a81-9a98-6508d850b4c6">
<img width="1390" alt="Screenshot 2024-06-24 at 20 59 39" src="https://github.com/pwr-cloudprogramming/a12-NouranElmenshawy/assets/147437528/6b0b08b8-446a-4cbb-88b5-bc8381a5afc4">
<img width="1418" alt="Screenshot 2024-06-24 at 20 59 43" src="https://github.com/pwr-cloudprogramming/a12-NouranElmenshawy/assets/147437528/22dd279d-876a-4ca7-a9f1-068c9772f52c">

### Preview

**Configured AWS Services:**

- **S3 Bucket:** `tic-tac-toe-pic-bucket-unique-name-12345` for storing profile pictures.
- **DynamoDB Table:** `TicTacToeScoresNew` for storing game results.
- **Lambda Function:** `UpdateRanking` for processing game results.
- **API Gateway:** Endpoints for submitting game results and uploading profile pictures.
- **SNS Topic:** `RankingNotifications` for sending ranking update notifications.

**Application Screenshot:**
- The running application showing player profiles with uploaded pictures and game results stored in the database.

### Reflections

**Learnings:**
- Gained experience with AWS services such as S3, DynamoDB, Lambda, API Gateway, and SNS.
- Learned how to securely handle file uploads and restrict access using IAM roles and security groups.

**Obstacles Overcome:**
- Overcame issues with securing S3 uploads using pre-signed URLs.
- Managed database access restrictions to ensure secure communication between services.

**Surprises:**
- The simplicity and efficiency of integrating AWS services to build a robust backend for the application.

**Database Choice:**
- Chose DynamoDB for its scalability, flexibility, and performance, making it suitable for handling game results and ranking calculations.
